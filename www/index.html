<!DOCTYPE HTML>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: content: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
  <script src="components/loader.js"></script>
  <link rel="stylesheet" href="components/loader.css">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script>
    // APIキーの設定とSDK初期化
    // API key.
    var applicationKey = "4d9d122337ca0de373857821e96b10ad1952a9133ffea44e66bcee94c282fccf";
    var clientKey = "00902e576a265322a217a2b2706056ca26048d4bd4f9096744fdd7e565d0f377";
    // SDK initialization.
    var ncmb = new NCMB(applicationKey, clientKey);
    // サンプルコード
    //保存先クラスの作成
    var TestClass = ncmb.DataStore("TestClass");

    //保存先クラスのインスタンスを生成
    var testClass = new TestClass();

    //値を設定と保存
    testClass.set("message", "Hello, NCMB!")
      .save()
      .then(function(object) {
        //保存に成功した場合の処理

      })
      .catch(function(err) {
        //保存に失敗した場合の処理
        alert("Failed to create new object, with error code: " + error.text);
      });

    // お試しカメラ
    function takePicture() {
      var options = {
        sourceType: Camera.PictureSourceType.CAMERA,
        destinationType: Camera.DestinationType.DATA_URL
      };

      navigator.camera.getPicture(onSuccess, onError, options);

      function onSuccess(imageData) {
        // ncmbに画像をアップロード
        var fileName = makeUUID() + ".jpg";
        var fileData = toBlob(imageData, "image/jpeg");
        ncmb.File.upload(fileName, fileData)
          .then(function(result) {
            alert("画像アップロード成功");

            //撮影した画像を画面に表示
            var image = document.getElementById("photo");
            image.src = "data:image/jpeg;base64," + imageData;

            // タイトルと画像の説明の入力欄を作成
            var title = document.createElement("input");
            title.id = "titleData";
            title.type = "text";
            title.placeholder = "タイトル";
            var comment = document.createElement("textarea");
            comment.id = "commentData";
            comment.placeholder = "画像の説明";
            // 画像情報の登録ボタンの生成
            var sendBtn = document.createElement("button");
            sendBtn.onclick = saveData(fileName);
            sendBtn.innerHTML = "情報を登録する";
            // 画面に追加
            document.getElementById("title").appendChild(title);
            document.getElementById("comment").appendChild(comment);
            document.getElementById("btn").appendChild(sendBtn);
          })
          .catch(function(error) {
            alert("画像アップロード失敗" + error);
          });
      }
      //撮影キャンセル
      function onError(message) {
        alert("エラー:" + message);
      }
    }

    //Blobを作成
    function toBlob(base64, mime_type) {
      var bin = atob(base64.replace(/^.*,/, ''));
      var buffer = new Uint8Array(bin.length);
      for (var i = 0; i < bin.length; i++) {
        buffer[i] = bin.charCodeAt(i);
      }

      try {
        var blob = new Blob([buffer.buffer], {
          type: mime_type
        });
      } catch (e) {
        return false;
      }
      return blob;
    }

    //UUID生成
    function makeUUID() {
      var d = +new Date();
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'
        .replace(/[xy]/g, function(c) {
          var r = (d + Math.random() * 16) % 16 | 0;
          return (c == 'X' ? r : (r & 0x3 | 0x8)).toString(16);

        });
    }

    function saveData(fileName) {
      return function() {
        var title = document.getElementById("titleData").value;
        var comment = document.getElementById("commentData").value;

        //入力チェック
        if (title === "" || comment === "") {
          return alert("未入力の項目があります")
        }

        var FileData = ncmb.DataStore("FileData");
        var fileData = new FileData();
        fileData.set("fileName", fileName)
          .set("title", title)
          .set("comment", comment)
          .save()
          .then(function(result) {
            //保存成功
            alert("画像情報保存成功")
          })
          .catch(function(error) {
            //保存失敗
            alert("画像情報保存失敗" + error);
          });
      }
    }
    //お試しカメラエンド

    //ログアウト
    function logout_button() {
      // カレントユーザー情報の取得
      var currentUser = ncmb.User.getCurrentUser();
      alert("ログアウト処理" + currentUser + "：ここ")
      if (currentUser) {
        console.log("ログイン中のユーザーINDEX: " + currentUser.get("userName"));
      } else {
        console.log("未ログインまたは取得に失敗");
      }
      ncmb.User.logout();
      // .then(function(){
      //   //成功
      //   console.log("ログアウト成功" + JSON.stringify(user));

      // })
      // .catch(function(){
      //   //失敗
      //   console.log("ログアウト失敗" + JSON.stringify(error));
      // })
      currentUser = null;
      document.location.href = './login.html';
    }
  </script>
</head>

<body id="prodact_lists">
  <!-- Header Start -->
  <header class="site-header">
    <div class="wrapper site-header__wrapper">
      <nav class="nav">
        <input class="hidden" type="checkbox" id="menu-btn-check"><span class="center">商品一覧</span>
        <label for="menu-btn-check" class="menu-btn"><span></span></label>
        <div class="menu-content">
          <ul>
            <li><a href="acount.html">アカウント詳細</a></li>
            <li><a href="#">通知</a></li>
            <li><a href="#">取引履歴</a></li>
            <li><a href="#">出品した譲渡品</a></li>
            <li><a href="#">出品した交換品</a></li>
            <li><a href="javascript:logout_button();">ログアウト</a></li>

          </ul>
        </div>
      </nav>
    </div>
  </header>
  <!-- Header End -->

  <!-- Body Start -->
  <div class="container" id="item_box">
    <div id="justified">
      <div id="left_just">
        <a>閲覧履歴</a>
      </div>
      <div id="right_just">
        <button class="transparent" onclick="location.href='viewHistory.html'">すべて見る<i class="fas fa-angle-right"></i></a></button>
      </div>
    </div>
  </div>

  <div class="container" id="item_box">
    <div id="justified">
      <div id="left_just">
        <a>譲渡品から探す</a>
      </div>
      <div id="right_just">
        <button class="transparent" onclick="location.href='giveList.html'">すべて見る<i class="fas fa-angle-right"></i></a></button>
      </div>
    </div>
  </div>

  <div class="container" id="item_box">
    <div id="justified">
      <div id="left_just">
        <a>交換品から探す</a>
      </div>
      <div id="right_just">
        <button class="transparent" onclick="location.href='tradeList.html'">すべて見る<i class="fas fa-angle-right"></i></a></button>
      </div>
    </div>
  </div>

  <!-- お試しカメラ -->
  <div>
    <button onclick="takePicture()">撮影</button>
  </div>
  <img class="photo" id="photo" src="" style="max-width: 80%; mac-height: 400px;1">
  <div id="title"></div>
  <div id="comment"></div>
  <div id="btn"></div>

  <br><br><br><br>
  <!-- お試しカメラエンド -->

  <!-- Body End -->

  <!-- Footer Start -->
  <ul class="bottom-menu">
    <li>
      <a href="#">
        <i class="far fa-list-alt"></i></a>
    </li>
    <li>
      <a href="deal.html"><i class="fas fa-random"></i></a>
    </li>
    <li>

      <a href="insert.html"><i class="fas fa-plus"></i></a>

    </li>
    <li>
      <a href="qrreader.html"><i class="fas fa-qrcode"></i></a>
    </li>
    <li>
      <a href="voice.html">
        <i class="fas fa-bullhorn"></i></a>
    </li>
  </ul>
  <!-- Fotter End -->
</body>

</html>