<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: content: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <script src="components/loader.js"></script>
    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="stylesheet" href="css/insert.css">
    <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <script type="text/javascript" src="css/main.js">
    </script>
    <script>
      // APIã‚­ãƒ¼ã®è¨­å®šã¨SDKåˆæœŸåŒ–
      // API key.
      var applicationKey = "4d9d122337ca0de373857821e96b10ad1952a9133ffea44e66bcee94c282fccf";
      var clientKey = "00902e576a265322a217a2b2706056ca26048d4bd4f9096744fdd7e565d0f377";
      // SDK initialization.
      var ncmb = new NCMB(applicationKey, clientKey);

      function newDeal(){
        
        // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
        var imageData = document.getElementById("preview").file;
        var item_image = imgUpload(imageData);// å…ˆè¡Œã—ã¦ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚ç”»åƒã®åå‰ã‚’è¿”ã™

        var category = document.getElementById("category").value;
        var delivery_end_date = document.getElementById("delivery_end_date").value;
        var delivery_start_date = document.getElementById("delivery_start_date").value;
        var delivery_time = document.getElementById("delivery_time").value;

        var item_info = document.getElementById("item_info").value;
        var item_name = document.getElementById("item_name").value;
        var item_status = document.getElementById("item_status").value;
        var location = document.getElementById("location").value;
        // 
        var Give = ncmb.DataStore("give");
        // ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆ
        var give = new Give();
        // ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¦ä¿å­˜ã™ã‚‹
        give.set("category", category)
        .set("deal_status", "æˆç«‹å¾…ã¡")
        .set("delivery_end_date", delivery_end_date)
        .set("delivery_start_date", delivery_start_date)
        .set("delivery_time", delivery_time)
        .set("item_image", item_image)
        .set("item_info", item_info)
        .set("item_name", item_name)
        .set("item_status", item_status)
        .set("location", location)
        .save();
        // ç¢ºèªç”¨ã‚¢ãƒ©ãƒ¼ãƒˆ
        alert("ç”»åƒ " + item_image);
      }

      // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
      function imgUpload(imageData) {
        // ncmbã«ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        var fileName = makeUUID() + ".jpg";
        ncmb.File.upload(fileName, imageData);
        
        // .then(function(result) {
        //   alert("ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ");
        // })
        // .catch(function(error) {
        //   alert("ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—" + error);
        // });
        return fileName;
      }

      // Blobä½œæˆ
      function toBlob(base64, mime_type) {
      var bin = atob(base64.replace(/^.*,/, ''));
      var buffer = new Uint8Array(bin.length);
      for (var i = 0; i < bin.length; i++) {
        buffer[i] = bin.charCodeAt(i);
      }

      try {
        var blob = new Blob([buffer.buffer], {
          type: mime_type
        });
      } catch (e) {
        return false;
      }
      return blob;
    }

    //UUIDç”Ÿæˆ
    function makeUUID() {
      var d = +new Date();
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'
        .replace(/[xy]/g, function(c) {
          var r = (d + Math.random() * 16) % 16 | 0;
          return (c == 'X' ? r : (r & 0x3 | 0x8)).toString(16);

        });
    }

      // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆä»®ï¼‰
      function modal_open(){
        const open = document.getElementById('d_open');
        const ok = document.getElementById('d_ok');
        const close = document.getElementById('d_cancel');
        const modal = document.getElementById('d_modal');
        const mask = document.getElementById('mask');
        
        open.addEventListener('click',()=>{
          modal.classList.remove('hidden');
          mask.classList.remove('hidden');
        });

        ok.addEventListener('click',()=>{
          newDeal();
          localStorage.setItem("flag","give");
          document.location.href='insertFixed.html';
        });
        
        close.addEventListener('click',()=>{
          modal.classList.add('hidden');
          mask.classList.add('hidden');
        });
        
        mask.addEventListener('click',()=>{
          close.click();
        });
      }
    </script>
</head>
<body id="prodact_lists">
	<!-- Header Start -->
    <header class="site-header">
      <div class="wrapper site-header__wrapper">
        <nav class="nav">
          <div class="detail_head">
            <div class="back_button">
              <a href="javascript:history.back()">
                <i class="fas fa-angle-left back_size"></i>
              </a>
            </div>
            <div class="page_title">
              <input class="hidden" type="checkbox" id="menu-btn-check"><span class="center">å•†å“æƒ…å ±ã®å…¥åŠ›</span>
              <label for="menu-btn-check" class="menu-btn"><span></span></label>
              <div style="text-align: left" class="menu-content">
                <ul>
                  <li><a href="#">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè©³ç´°</a></li>
                  <li><a href="#">è¨­å®š</a></li>
                  <li><a href="#">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
                </ul>
              </div>
            </div>
            <div class="header_right">
            </div>
          </div>
        </nav>
      </div>
    </header>
    <!-- Header End -->
    <div class="right">
    <button type="button" class="newDeal-btn" name="item_image" id="d_open" onclick="modal_open()"> å‡ºå“ã™ã‚‹ï¼ </button>
    </div>
    <div id="mask" class="hidden"></div><br><br><br>
    
    <!-- å•†å“ç”»åƒé¸æŠ -->
    <div class="flex" id="newDeal_info" name="item_image">
        <!-- ã‚«ãƒ¡ãƒ©ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
        <button class="btn-flat-border">
        ğŸ“·<input type="file" id="item_image" onChange="imgPreView(event)"/>
        </button>
        
        <!-- ã‚¢ãƒ«ãƒãƒ ã‹ã‚‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
        <form>
<!-- <<<<<<< HEAD
            <button class="btn-flat-border" id="item_image">
            ğŸ“š<input type="file" accept="image/*" multiple=" multiple" onchange="loadImage(this);">
======= -->
            <button class="btn-flat-border">
            ğŸ“š<input type="file" id="item_image" accept="image/*" multiple=" multiple" onchange="imgPreView(event)">

            </button>
        </form>
    </div>
     <!-- ğŸ‘‡ã“ã“ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã‚’è¿½åŠ ã™ã‚‹ -->
    <div class="flex" id="preview" width="300" height="200">
    </div>
    
    
    <div class="gray"><br>
    <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ -->
        <label for="category" class="leftmrg30px">ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
        <div class="flex" id="newDeal_info">
            <select id="category" name="category" size=1 class="nd_size">
                <option value="1">ãŠã‚‚ã¡ã‚ƒãƒ»ã‚²ãƒ¼ãƒ </option>
                <option value="2">æœ¬ãƒ»ãƒ†ã‚­ã‚¹ãƒˆ</option>
                <option value="3">éŸ³æ¥½ãƒ»ï¼¤ï¼¶ï¼¤</option>
                <option value="4">æœãƒ»ã‚³ã‚¹ãƒ¡</option>
                <option value="5">ã‚­ãƒƒãƒãƒ³</option>
                <option value="6">ã‚¹ãƒãƒ¼ãƒ„</option>
                <option value="7">PCãƒ»ã‚¹ãƒãƒ›ç”¨å“</option>
                <option value="100">ãã®ä»–</option>
            </select>
        </div><br>
    
    <!-- å•†å“ã®çŠ¶æ…‹ -->
        <label for="item_status" class="leftmrg30px">å•†å“ã®çŠ¶æ…‹</label>
        <div class="flex" id="newDeal_info">
            <select id="item_status" name="item_status" size="1" class="nd_size">
                <option value="1">æ–°å“</option>
                <option value="2">ã»ã¼æ–°å“</option>
                <option value="3">å¤šå°‘ã®å‚·ã‚ã‚Š</option>
                <option value="4">å‚·ãƒ»æ±šã‚Œã‚ã‚Š</option>
                <option value="5">çŠ¶æ…‹ãŒæ‚ªã„</option>
            </select>
        </div><br>
    </div><br><br><br>
    
    
    <div class="gray"><br>
    <!-- å•†å“åå…¥åŠ› -->
        <label for="item_name" class="leftmrg30px">å•†å“å</label>
        <div class="flex" id="newDeal_info" name="item_name">
            <input type="text" id="item_name" class="nd_size" name="name" required maxlength="50" size="52">
        </div><br>
    
    <!-- å•†å“æƒ…å ±å…¥åŠ› -->
        <label for="item_info" class="leftmrg30px">å•†å“ã®èª¬æ˜</label>
        <div class="flex" id="newDeal_info" name="item_info" >
            <textarea id="item_info" name="item_info" class="width" maxlength="250" rows="8"required></textarea>
        </div><br>
    </div><br><br><br>
    
    
    <div class="gray"><br>
    <!-- å—ã‘æ¸¡ã—æœŸé–“ -->
        <label for="delivery_start_date" class="leftmrg30px">å—ã‘æ¸¡ã—æœŸé–“</label>
        <div class="flex" id="newDeal_info">
            <input type="date" id="delivery_start_date" name="delivery_start_date" class="nd_size_times">
            <p><span class="margin10px">ï½</span></p>
            <input type="date" id="delivery_end_date" name="delivery_end_date" class="nd_size_times">
        </div>
    
    <!-- å—ã‘æ¸¡ã—æ™‚é–“å¸¯ -->
        <label for="delivery_time" class="leftmrg30px">å—ã‘æ¸¡ã—æ™‚é–“å¸¯</label>
        <div class="flex" id="newDeal_info">
            <select id="delivery_time" name="delivery_time" size="1" class="nd_size">
                <option value="1">ï¼‘ã‚³ãƒç›®çµ‚äº†å¾Œ</option>
                <option value="2">æ˜¼ä¼‘ã¿</option>
                <option value="3">ï¼“ã‚³ãƒç›®çµ‚äº†å¾Œ</option>
                <option value="4">ï¼”ã‚³ãƒç›®çµ‚äº†å¾Œ</option>
            </select>
        </div><br>
    
    <!-- å—ã‘æ¸¡ã—å ´æ‰€ -->
        <label for="location" class="leftmrg30px">å—ã‘æ¸¡ã—å ´æ‰€</label>
        <div class="flex" id="newDeal_info">
            <select id="location" name="location" size="1" class="nd_size">
                <option value="1">æœ¬æ ¡èˆ3Fãƒ›ãƒ¼ãƒ«</option>
                <option value="2">æœ¬æ ¡èˆ4Fãƒ›ãƒ¼ãƒ«</option>
                <option value="3">æœ¬æ ¡èˆ5F</option>
                <option value="4">æœ¬æ ¡èˆ6Fãƒ›ãƒ¼ãƒ«</option>
                <option value="5">æœ¬æ ¡èˆ7F</option>
                <option value="6">æœ¬æ ¡èˆ8F</option>
                <option value="7">2å·é¤¨å…¥å£</option>
                <option value="8">3å·é¤¨å…¥å£</option>
                <option value="9">3å·é¤¨ãƒ›ãƒ¼ãƒ«</option>
                <option value="100">ãã®ä»–</option>
            </select>
        </div><br>
    </div><br><br><br>
	
    
    <!-- Footer Start -->
    <ul class="bottom-menu">
    <li>
        <a href="index.html">
	<i class="far fa-list-alt"></i></a>
    </li>

    <li>
        <a href="deal.html"><i class="fas fa-random"></i></a>

    </li>
    <li>
 	<a href="insert.html"><i class="fas fa-plus"></i></a>
    </li>
    <li>
        <a href="qrreader.html"><i class="fas fa-qrcode"></i></a>
    </li>
    <li>
        <a href="voice.html">
	<i class="fas fa-bullhorn"></i></a>
    </li>
</ul>
    <!-- Fotter End -->
    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
      <section id="d_modal" class="hidden">
        <div class="modal_box">
          <a>å•†å“å</a>
          <br>
          <a>ã“ã®è¾ºã«ç”»åƒï¼ˆã§ã‹ã„ï¼‰</a>
          <br>
          <table class="modal_table">
            <tr>
              <th class="modal_table">ã‚«ãƒ†ã‚´ãƒªãƒ¼</th><td>å€¤</td>
            </tr>
            <tr>
              <th class="modal_table">å•†å“ã®çŠ¶æ…‹</th><td>å€¤</td>
            </tr>
            <tr>
              <th class="modal_table">å•†å“å</th><td>å€¤</td>
            </tr>
            <tr>
              <th class="modal_table">å—ã‘æ¸¡ã—æœŸé–“</th><td>å€¤</td>
            </tr>
            <tr>
              <th class="modal_table">å—ã‘æ¸¡ã—æ™‚é–“å¸¯</th><td>å€¤</td>
            </tr>
            <tr>
              <th class="modal_table">å—ã‘æ¸¡ã—å ´æ‰€</th><td>å€¤</td>
            </tr>
          </table>
        </div>
        <br>
        <a>ã“ã®å•†å“ã‚’ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ</a>
        <div id="d_button">
          <div id="d_cancel">
          é–‰ã˜ã‚‹
          </div>
          <div id="d_ok">
          é€²ã‚ã‚‹
          </div>
        </div>
      </section>
</body>
</html>
